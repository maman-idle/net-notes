STP (Spanning Tree Protocol)

Spanning Tree Protocol is a network technology that runs on layer 2. It mains function is to prevent broadcaststorm from happening. Broadcaststorm is a phenomenon where frame is broadcasted on layer 2 starting to loop within multiple switches, this happend because in layer 2 frame there is no Time To Live attribute in its header, unlike layer 3 packets. The broadcaststorm can take up a lot of bandwidth and it may congest the traffic in the network.

The presence of STP in the switches, shall perish the evil broadcaststorm. How did STP able to banish the evil broadcaststorm you may ask? Well, when the switches is configured with STP, they will communicate with each other and choose the route or path that won't create a circuit so the frame that will traverses trough the chosen path will arrives at the destined location and won't wanders and jamming the network.

Before creating a non-circuited path, the switches need to do some of these tasks first. 
1. Choosing the Root Bridge.
2. The other switches must create path to the Root Bridge (Root Port).
3. Determining the designated or alternate port between the non-Root Bridge switches.
Those three tasks are mandatory for achieving a non-circuited path between switches.

Alrighty, let's take a look at the first task. Choosing the Root Bridge. The Root Bridge is chosen by comparing Bridge ID between switches. Switch with the lowest Bridge ID will chosen as Root Bridge, easy. After the switch with the lowest Bridge ID is found, it will change the role of all its avtive ports as Designated port, meaning the ports on that switch are open and forwarding away from the Root Bridge (itself).  

Task two. The other switches have to select Root Port. Root ports are ports that forwarding toward the Root Bridge, so for every single switch must select an active port as a Root port. The process to select this port is by calculating the path costs for every active ports in that switch to the Root port. The path cost with the lowest cost between ports in that switch, will be assigned as the Root Port.

Last action to take to achieve a non-circuited path is determining the designated or alternate port between the non-Root Bridge switches. So basically in this task, we need to manage the paths between the non-Root Bridge switches. Lets say, there are four switches: switch A, B, C, and D. Switch A connects to switch B and C, and switch D connects to switch B and C too, so the topology is like a rectangle with a switch in its corner (all the switches connect with same cable type). Switch A is elected as Root Bridge because its Bridge ID is the lowest among these switches. So in switch A, the ports that connect to switch B, and C will be Designated ports. On switch B and C, they will choose the port that directly connect to switch A as the Root Ports because it has the lowest path cost to the Root Bridge. Meanwhile on switch D, it compares the path cost to the Root Bridge using the ports that connect to switch B and C. Because the path costs are same, it ends to tiebreaker by comparing the Bridge ID of switch B and C. Lets say the swtich C has the lower Bridge ID than switch B, the switch D port that connect to switch C will be elected as the Root Port. 

Alright, from scenario above. The switches manage to choose the Root Bridge and selecting Root Ports for every non-Root Bridge switches. Those are the first and second task we've already finished. Now for the last task, there is one path that is not been managed yet between switch B and switch D. One of these ports between these two switches, need to assigned as the Designated port (forwarding) and the Alternate port (blocking). To choose whose port will be the Designated port, the two switches must compare the path cost to the Root Bridge and the lowest cost will win, in this case the switch B has the lowest cost. So, the port on swtich B will be the Designated port and the port on switch D will be the Alternate port. 

Now, what if there is a new switch that connect to switch D using double connection/cable? Well, lets say the new switch is switch E, and its Bridge ID is higher than the switch A's Bridge ID which is the current Root Bridge, so the switch A is still become the Root Bridge. Switch E will needs to pick a Root Port between its connection to the switch D, but there are some problems here, the path costs to the Root Bridge on these two ports are same AND it comes from the SAME switch, which is switch D. We need tiebreaker here, and that tiebreaker is comparing the Port Id on switch D. Lets say the ports that connect from switch D to switch E are port F0/3 and F0/4, so the port on switch E that connect to port F0/3 on the switch D, will be the Root Port and the port F0/3 will be Designated port. Meanwhile, the port on switch E that connect to port F0/4 on switch D will be Alternate port and the port F0/4 will be Designated port.

